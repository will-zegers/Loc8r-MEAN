(function(){angular.module("loc8rApp",["ngRoute","ngSanitize","ui.bootstrap"]);function e(e,t){e.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/common/views/genericText.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/location/:locationid",{templateUrl:"/locationDetail/locationDetail.view.html",controller:"locationDetailCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode({enabled:true,requireBase:false})}angular.module("loc8rApp").config(["$routeProvider","$locationProvider",e])})();(function(){e.$inject=["$scope","loc8rData","geolocation"];function e(e,t,o){var r=this;r.pageHeader={title:"Loc8r",strapline:"Find places to work with wifi near you!"};r.sidebar={content:"Looking for wifi and a seat? Loc8r helps you find places to work when out and about. Perhaps with coffee, cake, or a pint? Let Loc8r help you find the place you're looing for."};r.message="Checking your location...";r.getData=function(e){var o=e.coords.latitude,n=e.coords.longitude;r.message="Searching for nearby places";t.locationByCoordinates(o,n).success(function(e){r.message=e.length>0?"":"No locations found";r.data={locations:e}}).error(function(e){r.message="Sorry, something's gone wrong"})};r.showError=function(t){e.$apply(function(){r.message=t.message})};r.noGeo=function(){e.$apply(function(){r.message="Geolocation not supported by this browser."})};o.getPosition(r.getData,r.showError,r.noGeo)}angular.module("loc8rApp").controller("homeCtrl",e)})();(function(){function e(){var e=this;e.pageHeader={title:"About"};e.main={content:"Loc8r was created to help people find places to sit down and get a bit of work done.\n\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Nam purus lacus, maximus ut sagittis et, porttitor a ipsum. Morbi at ullamcorper risus. Ut enim tortor, malesuada eget sagittis id, vulputate a sem. Curabitur ornare gravida neque. Proin sagittis faucibus porttitor. Nulla lorem dolor, tincidunt a dui ut, ultrices scelerisque sem. Morbi et nulla et elit scelerisque ultrices. Mauris leo turpis, luctus malesuada magna sed, maximus commodo urna.\n\nNam ut turpis at mi molestie elementum. Donec interdum nisl porttitor odio consectetur pharetra. Donec congue nibh a elit volutpat viverra. Sed lacinia, nunc convallis egestas vehicula, ex neque laoreet velit, vel ullamcorper ipsum risus nec dui. Nam molestie accumsan augue in pharetra. Suspendisse rutrum nisi velit, nec tincidunt ipsum auctor id. Etiam ac porta lorem. Morbi sit amet gravida odio. Sed tincidunt aliquam elementum. Integer dolor elit, laoreet eu sem at, scelerisque luctus velit. Duis nec lectus et velit blandit pulvinar sit amet at augue. Curabitur consectetur, nunc nec ultrices venenatis, purus justo cursus elit, vitae ultrices quam neque ultrices diam. Donec semper sem vitae sapien posuere, quis hendrerit arcu condimentum. Cras nec interdum ipsum."}}angular.module("loc8rApp").controller("aboutCtrl",e)})();(function(){e.$inject=["$location","authentication"];function e(e,t){var o=this;o.pageHeader={title:"Create a new Loc8r account"};o.credentials={name:"",email:"",password:""};o.returnPage=e.search().page||"/";o.onSubmit=function(){o.formError="";if(!o.credentials.name||!o.credentials.email||!o.credentials.password){o.formError="All fields required, please try again";return false}else{o.doRegister()}};o.doRegister=function(){o.formError="";t.register(o.credentials).error(function(e){o.formError=e}).then(function(){e.search("page",null);e.path(o.returnPage)})}}angular.module("loc8rApp").controller("registerCtrl",e)})();(function(){e.$inject=["$location","authentication"];function e(e,t){var o=this;o.pageHeader={title:"Sign in to Loc8r"};o.credentials={email:"",password:""};o.returnPage=e.search().page||"/";o.onSubmit=function(){o.formError="";if(!o.credentials.email||!o.credentials.password){o.formError="All fields required, please try again";return false}else{o.doLogin()}};o.doLogin=function(){o.formError="";t.login(o.credentials).error(function(e){o.formError=e}).then(function(){e.search("page",null);e.path(o.returnPage)})}}angular.module("loc8rApp").controller("loginCtrl",e)})();(function(){e.$inject=["$routeParams","$location","$uibModal","loc8rData","authentication"];function e(e,t,o,r,n){var i=this;i.locationid=e.locationid;i.isLoggedIn=n.isLoggedIn();i.currentPage=t.path();r.locationById(i.locationid).success(function(e){i.data={location:e};i.pageHeader={title:i.data.location.name}}).error(function(e){console.log(e)});i.popupReviewForm=function(){var e=o.open({templateUrl:"/reviewModal/reviewModal.view.html",controller:"reviewModalCtrl as vm",resolve:{locationData:function(){return{locationid:i.locationid,locationName:i.data.location.name}}}});e.result.then(function(e){i.data.location.reviews.push(e)})}}angular.module("loc8rApp").controller("locationDetailCtrl",e)})();(function(){e.$inject=["$location","authentication"];function e(e,t){var o=this;o.currentPath=e.path();o.isLoggedIn=t.isLoggedIn();o.currentUser=t.currentUser();o.logout=function(){t.logout();window.location.href="/#"}}angular.module("loc8rApp").controller("navigationCtrl",e)})();(function(){e.$inject=["$uibModalInstance","locationData","loc8rData"];function e(e,t,o){var r=this;r.locationData=t;r.onSubmit=function(){r.formError="";if(!r.formData||!r.formData.rating){r.formError="Name and rating fields required, please try again!";return false}else{r.doAddReview(t.locationid,r.formData)}};r.doAddReview=function(e,t){o.addReviewById(e,{rating:t.rating,reviewText:t.reviewText}).success(function(e){console.log(e);r.modal.close(e)}).error(function(e){r.formError="Your review has not been saved, try again"});return false};r.modal={close:function(t){console.log(t);e.close(t)},cancel:function(){e.dismiss("cancel")}}}angular.module("loc8rApp").controller("reviewModalCtrl",e)})();(function(){function e(){var e=function(e,t,o){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,t)}else{o()}};return{getPosition:e}}angular.module("loc8rApp").service("geolocation",e)})();(function(){e.$inject=["$http","authentication"];function e(e,t){var o=function(t,o){return e.get("/api/locations?lat="+t+"&lng="+o+"&maxDistance=200")};var r=function(t){return e.get("/api/locations/"+t)};var n=function(o,r){return e.post("/api/locations/"+o+"/reviews",r,{headers:{Authorization:"Bearer "+t.getToken()}})};return{locationByCoordinates:o,locationById:r,addReviewById:n}}angular.module("loc8rApp").service("loc8rData",e)})();(function(){e.$inject=["$window","$http"];function e(e,t){var o=function(t){e.localStorage["loc8r-token"]=t};var r=function(){return e.localStorage["loc8r-token"]};var n=function(e){return t.post("/api/register",e).success(function(e){o(e.token)})};var i=function(e){return t.post("/api/login",e).success(function(e){o(e.token)})};var a=function(){var t=r();if(t){var o=JSON.parse(e.atob(t.split(".")[1]));return o.exp>Date.now()/1e3}else{return false}};var l=function(){if(a()){var t=r();var o=JSON.parse(e.atob(t.split(".")[1]));return{email:o.email,name:o.name}}};var c=function(t){e.localStorage.removeItem("loc8r-token")};return{saveToken:o,getToken:r,register:n,login:i,isLoggedIn:a,currentUser:l,logout:c}}angular.module("loc8rApp").service("authentication",e)})();(function(){var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};var t=function(){return function(t){var o,r;if(t&&e(t)){if(t>1){o=parseFloat(t).toFixed(1);r=" miles"}else{o=parseInt(t*528,10)*10;r=" feet"}return o+r}else{return"?"}}};angular.module("loc8rApp").filter("formatDistance",t)})();(function(){function e(){return function(e){var t=e.replace(/\n/g,"<br/>");return t}}angular.module("loc8rApp").filter("addHtmlLineBreaks",e)})();(function(){function e(){return{restrict:"EA",scope:{thisRating:"=rating"},templateUrl:"/common/directives/ratingStars/ratingStars.template.html"}}angular.module("loc8rApp").directive("ratingStars",e)})();(function(){function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}angular.module("loc8rApp").directive("footerGeneric",e)})();(function(){function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}angular.module("loc8rApp").directive("navigation",e)})();(function(){function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}angular.module("loc8rApp").directive("pageHeader",e)})();